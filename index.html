<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Order Form - SYNAPPSE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!--
        Content Security Policy (CSP):
        This meta tag helps protect against Cross-Site Scripting (XSS) and data injection attacks
        by restricting the sources from which the browser can load resources.

        Updated for Google Apps Script (FormEasy backend).
        'script.google.com' is allowed for script execution and form submissions.
    -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://cdn.tailwindcss.com 'unsafe-inline';
        style-src 'self' https://fonts.googleapis.com https://cdn.tailwindcss.com 'unsafe-inline';
        font-src 'self' https://fonts.gstatic.com;
        connect-src 'self' https://script.google.com; /* Allow connections to Google Apps Script */
        form-action https://script.google.com; /* Allow form submissions to Google Apps Script */
    ">
    <style>
        /* Custom scrollbar for a sleeker look */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #374151; /* Darker gray for track */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* Medium gray for thumb */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* Lighter gray on hover */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0f1a; /* Even darker charcoal background */
            background-image: radial-gradient(at 50% 0%, #1a202c 0%, #0d0f1a 70%); /* Subtle radial gradient from top */
            color: #e5e7eb; /* Light gray text */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for longer forms */
            min-height: 100vh;
            /* Default padding for mobile-first approach */
            padding: 1.5rem 0.5rem; /* 24px top/bottom, 8px left/right */
            box-sizing: border-box;
            /* Disable text selection */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE 10+ */
            user-select: none; /* Standard syntax */
        }

        /* Adjust body padding for small screens and up */
        @media (min-width: 640px) { /* sm breakpoint */
            body {
                padding: 2.5rem 1.5rem; /* Original padding for small screens and up */
            }
        }

        .form-container {
            position: relative;
            width: 100%;
            max-width: 48rem; /* Increased max-width for a slightly wider form */
        }

        @media (min-width: 768px) { /* md breakpoint */
            .form-container {
                /* No padding here as it's now handled by body or individual sections */
            }
        }

        .form-header-gradient {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 24px; /* Taller gradient */
            background: linear-gradient(to right, #3b82f6, #6366f1); /* Blue to indigo gradient for a more "techy" feel */
            z-index: 0;
            border-radius: 1rem 1rem 0 0; /* Apply border-radius only to the top of the gradient */
        }

        #dpa-section { /* DPA section retains its styles including border */
            position: relative;
            z-index: 10;
            /* Default padding for mobile-first approach */
            padding: 1.5rem; /* 24px all around */
            background-color: #242b38; /* Darker blue-gray for sections */
            border-radius: 0.75rem; /* More rounded */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* More pronounced inner shadow */
            transition: all 0.4s ease-in-out; /* Smoother transition */
            border: 1px solid #374151; /* Clearer border */
            margin-bottom: 2rem; /* Add margin below DPA section */
        }

        /* Adjust section padding for small screens and up */
        @media (min-width: 640px) { /* sm breakpoint */
            #dpa-section {
                padding: 2rem; /* Original padding for small screens and up */
            }
        }

        .section-title {
            /* Default font size for mobile-first approach */
            font-size: 1.375rem; /* 22px */
            font-weight: 600; /* Semibold */
            color: #e2e8f0; /* Ensure good contrast */
            margin-bottom: 1.5rem; /* Adjusted margin */
            border-bottom: 2px solid #3b82f6; /* Blue accent line */
            padding-bottom: 0.75rem;
        }

        /* Adjust section title font size for small screens and up */
        @media (min-width: 640px) { /* sm breakpoint */
            .section-title {
                font-size: 1.75rem; /* 28px */
            }
        }
        /* Adjust section title font size for medium screens and up */
        @media (min-width: 768px) { /* md breakpoint */
            .section-title {
                font-size: 2rem; /* Original size for medium screens and up */
            }
        }

        .form-group {
            margin-bottom: 1.75rem; /* Increased margin */
        }

        .form-label {
            display: block;
            color: #cbd5e0; /* Lighter gray label */
            font-size: 0.9375rem; /* Slightly larger font */
            font-weight: 500; /* Medium weight */
            margin-bottom: 0.625rem; /* Adjusted margin */
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.875rem; /* Increased padding */
            background-color: #2d3748; /* Darker gray input */
            border: 1px solid #4a5568; /* Clearer border */
            border-radius: 0.5rem; /* More rounded */
            outline: none;
            transition: all 0.2s ease-in-out;
            color: #e2e8f0;
            font-size: 1rem;
            placeholder-color: #6b7280;
        }

        .form-input:focus,
        .form-textarea:focus {
            border-color: #3b82f6; /* Blue border on focus */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4); /* Blue glow on focus */
        }

        .form-textarea {
            min-height: 8rem; /* Minimum height for textarea */
            resize: vertical; /* Allow vertical resizing */
        }

        .form-checkbox {
            height: 1.25rem; /* Increased size */
            width: 1.25rem; /* Increased size */
            color: #3b82f6; /* Blue checkbox */
            background-color: #374151;
            border: 1px solid #4b5563;
            border-radius: 0.25rem;
            transition: all 0.15s ease-in-out;
        }
        .form-checkbox:focus {
            ring: 3px;
            ring-offset: 2px;
            ring-offset-color: #1a202c;
            ring-color: #3b82f6;
        }

        .agree-label {
            margin-left: 0.75rem; /* Adjusted margin */
            color: #d1d5db;
            font-size: 1rem;
            cursor: pointer;
            user-select: none;
        }

        .button {
            width: 100%;
            padding: 1rem 1.75rem; /* Increased padding */
            background: linear-gradient(to right, #3b82f6, #2563eb); /* Vibrant blue gradient */
            color: #f9fafb; /* Off-white text */
            font-weight: 700; /* Bold */
            font-size: 1.125rem; /* Larger font size */
            border-radius: 0.625rem; /* More rounded */
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1); /* Stronger initial shadow */
            transition: all 0.3s ease-in-out;
            transform: translateY(0) scale(1);
            outline: none;
            border: none;
            cursor: pointer;
        }

        .button:hover {
            background: linear-gradient(to right, #60a5fa, #3b82f6); /* Lighter gradient on hover */
            transform: translateY(-2px) scale(1.01); /* Slight lift and scale */
            box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.3), 0 6px 10px -3px rgba(0, 0, 0, 0.15); /* More dramatic shadow on hover */
        }

        .button:active {
            background: linear-gradient(to right, #2563eb, #1d4ed8); /* Darker gradient on active */
            transform: translateY(0) scale(0.99); /* Slight press effect */
            box-shadow: 0 4px 8px -2px rgba(0, 0, 0, 0.15), 0 2px 4px -1px rgba(0, 0, 0, 0.08);
        }

        .button:disabled {
            background: #4b5563;
            cursor: not-allowed;
            opacity: 0.6; /* Reduced opacity */
            transform: none;
            box-shadow: none;
        }

        /* Message box styles are mostly removed as Formspree handles redirect */
        #message-box {
            display: none; /* Hide the message box for Formspree */
        }

        /* Styles for the custom message box */
        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
        }

        .message-box-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .message-box-content {
            background-color: #242b38;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: translateY(-20px);
            opacity: 0;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }

        .message-box-overlay.visible .message-box-content {
            transform: translateY(0);
            opacity: 1;
        }

        .message-box-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 1rem;
        }

        .message-box-text {
            font-size: 1rem;
            color: #cbd5e0;
            margin-bottom: 1.5rem;
        }

        .message-box-close-button {
            background: linear-gradient(to right, #3b82f6, #2563eb);
            color: #f9fafb;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
        }

        .message-box-close-button:hover {
            background: linear-gradient(to right, #60a5fa, #3b82f6);
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="antialiased">
    <div class="form-container">
        <div id="dpa-section" class="opacity-100 scale-100">
            <h2 class="text-2xl md:text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-blue-500 mb-6 text-center">Data Privacy Agreement</h2>
            <p class="text-gray-300 mb-4 leading-relaxed text-sm md:text-base">
                In compliance with the Republic Act No. 10173, also known as the Data Privacy Act of 2012 of the Philippines, we are committed to protecting your personal information.
            </p>
            <p class="text-gray-300 mb-4 leading-relaxed text-sm md:text-base">
                By proceeding with this form, you agree that SYNAPPSE may collect, use, process, and store the personal data you provide for the purpose of processing your order, communicating updates, and maintaining a record of our transactions. This includes your name, contact details, and social media handles.
            </p>
            <p class="text-gray-300 mb-6 leading-relaxed text-sm md:text-base">
                Your data will be kept confidential and will not be shared with third parties without your explicit consent, except as required by law. You have the right to access, correct, or delete your personal information held by us. For more details, please refer to our full Privacy Policy.
            </p>
            <div class="flex items-center mb-6">
                <input type="checkbox" id="agree-dpa" class="form-checkbox">
                <label for="agree-dpa" class="agree-label">
                    I have read and agree to the <span class="text-blue-400 hover:text-blue-300 font-medium">Data Privacy Agreement</span> and <span class="text-blue-400 hover:text-blue-300 font-medium">Terms & Conditions</span>.
                </label>
            </div>
            <button id="proceed-button" class="button" disabled>
                Proceed to Form
            </button>
        </div>

        <form id="order-form" class="hidden opacity-0 translate-y-4" action="https://script.google.com/macros/s/AKfycbx9hkusEO2X0R7QGlFLQ6mwPuDVXOC-a039eVJE2WIsKVDf95LuUMpdlz9I6O3ZXVFh/exec" method="POST">
            <h1 class="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-blue-500 mb-6 text-center drop-shadow-lg">
                SYNAPPSE Order Request
            </h1>

            <div class="mb-6">
                <h2 class="section-title">Order Details</h2>
                <div class="form-group">
                    <label for="order-type" class="form-label">Type of Order <span class="text-red-400">*</span></label>
                    <input type="text" id="order-type" name="Order Type" required class="form-input" placeholder="e.g., Custom Illustration, Website Design, Video Editing">
                </div>
                <div class="form-group">
                    <label for="order-description" class="form-label">Detailed Description <span class="text-red-400">*</span></label>
                    <textarea id="order-description" name="Description" rows="4" required class="form-textarea" placeholder="Please provide as much detail as possible about your project, including specific requirements, desired outcomes, and any reference materials."></textarea>
                </div>
                <div class="form-group">
                    <label for="Schedule a Meeting" class="form-label">Schedule a Meeting</label>
                    <input type="date" id="Schedule a Meeting" name="Schedule a Meeting" class="form-input">
                </div>
            </div>

            <div class="mb-6">
                <h2 class="section-title">Client Information</h2>
                <div class="form-group">
                    <label for="full-name" class="form-label">Full Name <span class="text-red-400">*</span></label>
                    <input type="text" id="full-name" name="Full Name" required class="form-input" placeholder="Juan dela cruz">
                </div>
                <div class="form-group">
                    <label for="email" class="form-label">Email Address <span class="text-red-400">*</span></label>
                    <input type="email" id="email" name="Email" required class="form-input" placeholder="your.email@example.com">
                </div>
                <div class="form-group">
                    <label for="phone" class="form-label">Phone Number <span class="text-red-400">*</span></label>
                    <input type="tel" id="phone" name="Phone Number" required class="form-input" placeholder="+63 9XX XXX XXXX">
                </div>
            </div>

            <div class="mb-6">
                <h2 class="section-title">Social Media & Links <span class="text-gray-400 text-sm">(Optional)</span></h2>
                <p class="text-gray-400 text-sm mb-2">Provide links or usernames to help us understand your brand or connect with you.</p>
                <div class="form-group">
                    <label for="facebook" class="form-label">Facebook Profile/Page</label>
                    <input type="text" id="facebook" name="Facebook Profile" class="form-input" placeholder="https://facebook.com/yourpage or @yourusername">
                </div>
                <div class="form-group">
                    <label for="instagram" class="form-label">Instagram Handle</label>
                    <input type="text" id="instagram" name="Instagram Handle" class="form-input" placeholder="@yourinstagram">
                </div>
                <div class="form-group">
                    <label for="twitter" class="form-label">Twitter/X Handle</label>
                    <input type="text" id="twitter" name="Twitter Handle" class="form-input" placeholder="@yourtwitter">
                </div>
            </div>

            <!-- Honeypot field for bot detection -->
            <div style="position: absolute; left: -9999px;">
                <input type="text" name="hp_email" tabindex="-1" autocomplete="off">
            </div>

            <button type="submit" id="submit-button" class="button">
                Submit Order Request
            </button>
        </form>

        <!-- Custom Message Box for DPA and other client-side messages -->
        <div id="message-box-overlay" class="message-box-overlay">
            <div class="message-box-content">
                <h3 id="message-box-title" class="message-box-title"></h3>
                <p id="message-box-text" class="message-box-text"></p>
                <button id="message-box-close" class="message-box-close-button">
                    Close
                </button>
            </div>
        </div>

    </div>

    <script>
        // IMPORTANT: Configure your FormEasy backend URL here.
        // Replace this with your actual Google Apps Script Web App URL.
        // It will look something like: 'https://script.google.com/macros/s/AKfycb.../exec'
        const FORMEASY_API_ENDPOINT = 'YOUR_APPS_SCRIPT_WEB_APP_URL';

        const agreeDpaCheckbox = document.getElementById('agree-dpa');
        const proceedButton = document.getElementById('proceed-button');
        const dpaSection = document.getElementById('dpa-section');
        const orderForm = document.getElementById('order-form');
        const submitButton = document.getElementById('submit-button');
        const messageBoxOverlay = document.getElementById('message-box-overlay');
        const messageBoxTitle = document.getElementById('message-box-title');
        const messageBoxText = document.getElementById('message-box-text');
        const messageBoxClose = document.getElementById('message-box-close');

        // Client-side rate limiting variables
        const SUBMISSION_COOLDOWN_TIME_MS = 5000; // 5 seconds cooldown
        let lastSubmissionTime = 0;

        /**
         * Displays a custom message box to the user.
         * @param {string} title - The title of the message box.
         * @param {string} content - The content/body of the message.
         */
        function showMessageBox(title, content) {
            messageBoxTitle.textContent = title;
            messageBoxText.textContent = content;
            messageBoxOverlay.classList.add('visible');
        }

        /**
         * Hides the custom message box.
         */
        function hideMessageBox() {
            messageBoxOverlay.classList.remove('visible');
        }

        // Event listener for closing the message box
        messageBoxClose.addEventListener('click', hideMessageBox);
        messageBoxOverlay.addEventListener('click', function(event) {
            // Close if clicked outside the content box
            if (event.target === messageBoxOverlay) {
                hideMessageBox();
            }
        });

        // Toggle proceed button based on DPA checkbox
        agreeDpaCheckbox.addEventListener('change', function() {
            if (this.checked) {
                proceedButton.disabled = false;
                proceedButton.classList.remove('opacity-50', 'cursor-not-allowed');
                proceedButton.classList.add('hover:scale-105');
            } else {
                proceedButton.disabled = true;
                proceedButton.classList.add('opacity-50', 'cursor-not-allowed');
                proceedButton.classList.remove('hover:scale-105');
            }
        });

        // Handle proceed button click
        proceedButton.addEventListener('click', function() {
            if (agreeDpaCheckbox.checked) {
                // Animate DPA section out
                dpaSection.classList.add('opacity-0', 'scale-95');
                setTimeout(() => {
                    dpaSection.classList.add('hidden');
                    // Animate order form in
                    orderForm.classList.remove('hidden');
                    setTimeout(() => {
                        orderForm.classList.remove('opacity-0', 'translate-y-4');
                    }, 50); // Small delay to allow 'hidden' class to apply before starting transition
                }, 400); // Wait for DPA section fade-out transition
            } else {
                showMessageBox('Agreement Required', 'Please agree to the Data Privacy Agreement and Terms & Conditions to proceed.');
            }
        });

        // Add input sanitization for all text and textarea inputs
        document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], textarea').forEach(input => {
            input.addEventListener('paste', function(event) {
                event.preventDefault(); // Prevent default paste behavior
                const text = event.clipboardData.getData('text/plain'); // Get plain text from clipboard
                // Sanitize the pasted text: remove any HTML tags
                const sanitizedText = text.replace(/<[^>]*>?/gm, '');
                // Insert sanitized text at the current cursor position
                const start = this.selectionStart;
                const end = this.selectionEnd;
                this.value = this.value.substring(0, start) + sanitizedText + this.value.substring(end);
                this.setSelectionRange(start + sanitizedText.length, start + sanitizedText.length);
                this.dispatchEvent(new Event('input', { bubbles: true })); // Trigger input event for validation/other handlers
            });

            // Basic input validation on input event (can be expanded)
            input.addEventListener('input', function() {
                // Example: Prevent leading/trailing whitespace
                // This is a simple client-side measure; server-side is essential
                if (this.value.length > 0 && (this.value.startsWith(' ') || this.value.endsWith(' '))) {
                    this.value = this.value.trim();
                }
            });
        });


        // Handle form submission with client-side rate limiting and fetch API
        orderForm.addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent default form submission

            const currentTime = Date.now();
            if (currentTime - lastSubmissionTime < SUBMISSION_COOLDOWN_TIME_MS) {
                showMessageBox('Too Many Requests', `Please wait ${((SUBMISSION_COOLDOWN_TIME_MS - (currentTime - lastSubmissionTime)) / 1000).toFixed(1)} seconds before submitting again.`);
                return;
            }

            lastSubmissionTime = currentTime; // Update last submission time

            // Disable button immediately after submission to prevent double clicks
            submitButton.disabled = true;
            submitButton.textContent = 'Submitting...'; // Provide feedback
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');

            const formData = new FormData(orderForm);
            const data = {};
            // FormEasy expects name, email, message by default, and others via setFields.
            // Ensure the keys here match your form field 'name' attributes.
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            try {
                // FormEasy expects 'Content-Type': 'application/x-www-form-urlencoded' or no header for typical form submissions,
                // but since we are sending JSON, we must stick with 'application/json' for fetch to send stringified JSON.
                // The doPost function in Apps Script with FormEasy.action(req) handles JSON parsing automatically.
                const response = await fetch(FORMEASY_API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json' // FormEasy's doPost can parse JSON body
                    },
                    body: JSON.stringify(data)
                });

                // FormEasy.action(req) returns a ContentService.createTextOutput()
                // which often has a default Content-Type like text/html or text/plain.
                // It does NOT necessarily return JSON by default for success/failure.
                // We'll check for response.ok (status 200) for success.
                if (response.ok) {
                    // FormEasy usually returns a simple success message or no body on success.
                    // If you've customized FormEasy to return JSON, uncomment and use response.json().
                    // const result = await response.json();
                    console.log('Form submission successful. Response:', await response.text()); // Log raw response text
                    showMessageBox('Success!', 'Your order request has been submitted successfully. We will get back to you shortly.');
                    orderForm.reset(); // Clear the form fields
                } else {
                    const errorText = await response.text(); // Get raw text for errors
                    console.error('Form submission failed:', response.status, errorText);
                    showMessageBox('Submission Failed', `There was an error submitting your form: ${response.status} - ${errorText || 'Unknown Error'}. Please check your Apps Script setup.`);
                }
            } catch (error) {
                console.error('Network error during form submission:', error);
                showMessageBox('Network Error', 'Could not connect to the Google Apps Script server. Please check your internet connection and verify the API endpoint.');
            } finally {
                // Re-enable button after response (or error)
                submitButton.disabled = false;
                submitButton.textContent = 'Submit Order Request';
                submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });

        // Code Protection: Disable right-click and common copy shortcuts
        document.addEventListener('contextmenu', event => event.preventDefault()); // Disable right-click

        document.addEventListener('keydown', event => {
            // Disable Ctrl+C, Ctrl+X, Ctrl+A, Ctrl+U, F12 (for Windows/Linux)
            // Disable Cmd+C, Cmd+X, Cmd+A, Cmd+U, Option+Cmd+I (for Mac)
            // Also prevent F10 (menu bar)
            if ((event.ctrlKey || event.metaKey) && ['c', 'x', 'a', 'u'].includes(event.key.toLowerCase())) {
                event.preventDefault();
            }
            if (event.key === 'F12' || (event.metaKey && event.altKey && event.key === 'i')) { // F12 and Option+Cmd+I for dev tools
                event.preventDefault();
            }
            if (event.key === 'F10') { // F10 for menu bar
                event.preventDefault();
            }
            // Note: Alt+F4 is generally handled by the OS and might not be preventable here.
        });

        // Disable text selection using CSS (already added to body style)
        // body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
    </script>
</body>
</html>
